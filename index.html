<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Flue checker</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div id="app">
    <aside id="sidebar">
      <h2>Flue Genie</h2>

      <div class="upload-block">
        <label for="bgUpload">1. Upload wall photo</label>
        <input type="file" id="bgUpload" accept="image/*">
      </div>

      <label>
        Boiler type
        <select id="boilerType">
          <option value="fan" selected>Fan-assisted / room-sealed</option>
        </select>
      </label>

      <label>
        Manufacturer / set
        <select id="manufacturerSelect"></select>
      </label>

      <label for="calibValue">Known flue OD (mm)</label>
      <input id="calibValue" type="number" value="100" min="40" max="200" step="1">

      <div id="instructions">
        <p>1. Upload the wall photo.</p>
        <p>2. Select maker (clearances update).</p>
        <p>3. Tap “Flue ellipse” and size it tightly around the terminal.</p>
        <p>4. Pick a tool (window opening, gutter, eaves) and tap 2–3 points to mark it.</p>
        <p>5. Use “Auto-detect objects” or “AI: refine with my marks” for overlays.</p>
      </div>

      <div id="tools">
        <button data-tool="window-opening">Window opening (300mm)</button>
        <button data-tool="window-fabric">Window fabric (150mm)</button>
        <button data-tool="gutter">Gutter / pipe (75mm)</button>
        <button data-tool="eaves">Eaves / soffit (200mm)</button>
        <button data-tool="boundary">Facing surface (600mm)</button>
        <button data-tool="flue" class="primary">Flue ellipse</button>
        <button id="undoBtn">Undo</button>
      </div>

      <div id="assistControls">
        <button id="autoDetectBtn">Auto-detect objects</button>
        <button id="roughBrushBtn">Rough paint → AI clean</button>
      </div>

      <div id="aiControls">
        <button id="aiAutoBtn">Auto-detect objects</button>
        <button id="aiRefineBtn">AI: refine with my marks</button>
        <div id="aiStatus" class="muted" role="status" aria-live="polite"></div>
        <div id="legend"></div>
        <ul id="aiList"></ul>
      </div>
    </aside>
    <main>
      <div id="canvasWrapper">
        <canvas id="sceneCanvas" width="900" height="600"></canvas>
      </div>

      <section id="resultsPanel">
        <h3>Results</h3>
        <table id="resultsTable">
          <thead>
            <tr>
              <th>#</th>
              <th>Object</th>
              <th>Rule</th>
              <th>Required (mm)</th>
              <th>Actual (mm)</th>
              <th>OK?</th>
            </tr>
          </thead>
          <tbody>
            <tr class="empty">
              <td colspan="6">Add a flue and marks to see clearances.</td>
            </tr>
          </tbody>
        </table>
      </section>

      <div class="previews">
        <div>
          <h3>Option A (move)</h3>
          <canvas id="optA" width="320" height="200"></canvas>
        </div>
        <div>
          <h3>Option B (plume)</h3>
          <canvas id="optB" width="320" height="200"></canvas>
        </div>
        <div>
          <h3>Option C (extend + plume)</h3>
          <canvas id="optC" width="320" height="200"></canvas>
        </div>
        <div>
          <h3>Option D (swan neck)</h3>
          <canvas id="optD" width="320" height="200"></canvas>
        </div>
      </div>
    </main>
  </div>
  <script>
    const aiStatus = document.getElementById("aiStatus");
    const autoBtn = document.getElementById("aiAutoBtn");
    const refineBtn = document.getElementById("aiRefineBtn");
    if (autoBtn) {
      autoBtn.addEventListener("click", () => {
        if (typeof window.runAiAuto === "function") {
          window.runAiAuto();
        }
      });
    }
    if (refineBtn) {
      refineBtn.addEventListener("click", () => {
        if (typeof window.runAiRefine === "function") {
          window.runAiRefine();
        }
      });
    }
  </script>

  <script type="module" src="app.js"></script>
</body>
</html>
